# BIZRA Architecture Diagrams

## Companion to Architecture Blueprint v2.3.0

---

## 1. Complete System Flow Diagram

```
+===================================================================================================+
|                                   BIZRA SOVEREIGN ARCHITECTURE                                     |
+===================================================================================================+
|                                                                                                    |
|  USER REQUEST                                                                                      |
|       |                                                                                            |
|       v                                                                                            |
|  +=========+     +=========+     +=========+     +=========+     +=========+                       |
|  |  FATE   |---->| SESSION |---->|   NTU   |---->|COGNITIVE|---->| COMPUTE |                       |
|  |  GATE   |     |   DAG   |     | MONITOR |     | BUDGET  |     | MARKET  |                       |
|  | (L1)    |     |  (L2)   |     |  (L0)   |     |  (L3)   |     |  (L4)   |                       |
|  +====+====+     +====+====+     +====+====+     +====+====+     +====+====+                       |
|       |              |              |              |              |                                |
|       | ALLOW/BLOCK  | state hash   | belief       | tier         | license                       |
|       |              |              |              |              |                                |
|       +-------+------+------+------+------+------+------+--------+                                |
|               |                                                                                    |
|               v                                                                                    |
|        +============+                                                                              |
|        | INFERENCE  |<----------------------------------------------------+                       |
|        |  GATEWAY   |                                                      |                       |
|        +============+                                                      |                       |
|               |                                                            |                       |
|               | SELECT BACKEND                                             |                       |
|               v                                                            |                       |
|   +-----------+-----------+-----------+-----------+-----------+            |                       |
|   |           |           |           |           |           |            |                       |
|   v           v           v           v           v           |            |                       |
| +====+     +====+     +====+     +====+     +====+           |            |                       |
| |NANO|     |MICRO|    |MESO|     |MACRO|    |MEGA|           |            |                       |
| |0.5B|     |1.5B |    | 7B |     | 13B |    | 70B|           |            |                       |
| +====+     +====+     +====+     +====+     +====+           |            |                       |
|   |           |           |           |           |           |            |                       |
|   +-----+-----+-----+-----+-----+-----+-----+-----+           |            |                       |
|         |                                                     |            |                       |
|         v                                                     |            |                       |
|  +============+     +============+     +============+         |            |                       |
|  |    PCI     |---->| FEDERATION |<--->|    A2A     |         |            |                       |
|  |  ENVELOPE  |     |   GOSSIP   |     |   ENGINE   |---------+            |                       |
|  +============+     +============+     +============+                      |                       |
|         |                 |                                                |                       |
|         | signed          | P2P sync                                       |                       |
|         v                 v                                                |                       |
|  +============+     +============+                                         |                       |
|  |   VAULT    |     |   PEER     |                                         |                       |
|  | (Encrypt)  |     |   NODES    |                                         |                       |
|  +============+     +============+                                         |                       |
|         |                                                                  |                       |
|         +------------------------------------------------------------------+                       |
|                                                                                                    |
+===================================================================================================+
```

---

## 2. 5-Layer Governance Stack (Detailed)

```
+=============================================================================+
|                        5-LAYER GOVERNANCE STACK                              |
+=============================================================================+
|                                                                              |
|  LAYER 4: COMPUTE MARKET (Harberger Tax + Gini)                              |
|  +------------------------------------------------------------------------+  |
|  |                                                                        |  |
|  |   +------------------+    +------------------+    +------------------+ |  |
|  |   | InferenceLicense |    | PatternLicense   |    | FederationLicense| |  |
|  |   |                  |    |                  |    |                  | |  |
|  |   | self_value: $100 |    | self_value: $50  |    | self_value: $200 | |  |
|  |   | tax_rate: 7%/yr  |    | tax_rate: 5%/yr  |    | tax_rate: 10%/yr | |  |
|  |   +------------------+    +------------------+    +------------------+ |  |
|  |                                                                        |  |
|  |   CONSTRAINT: Gini(licenses) <= 0.35                                   |  |
|  |                                                                        |  |
|  +------------------------------------------------------------------------+  |
|      |                                                                       |
|      | license_check(node_id) -> (has_license, remaining_budget)             |
|      v                                                                       |
|  LAYER 3: COGNITIVE BUDGET (7-3-6-9 Signature)                               |
|  +------------------------------------------------------------------------+  |
|  |                                                                        |  |
|  |   Task Analysis                     Budget Allocation                  |  |
|  |   +--------------+                  +-----------------------+          |  |
|  |   | complexity   |----------------->| NANO:  70% of traffic |          |  |
|  |   | token_count  |                  | MICRO: 20% of traffic |          |  |
|  |   | latency_req  |                  | MESO:  30% allocation |          |  |
|  |   | domain       |                  | MACRO:  6% allocation |          |  |
|  |   +--------------+                  | MEGA:   9% allocation |          |  |
|  |                                     +-----------------------+          |  |
|  |                                                                        |  |
|  +------------------------------------------------------------------------+  |
|      |                                                                       |
|      | allocate(task) -> (tier, tokens, timeout)                             |
|      v                                                                       |
|  LAYER 2: SESSION DAG (Merkle-Proven State)                                  |
|  +------------------------------------------------------------------------+  |
|  |                                                                        |  |
|  |       [root]                                                           |  |
|  |          |                                                             |  |
|  |        [init]                                                          |  |
|  |          |                                                             |  |
|  |       [active]--------+                                                |  |
|  |          |            |                                                |  |
|  |     [computing]    [branch]                                            |  |
|  |          |            |                                                |  |
|  |     [validated]       |                                                |  |
|  |          |            |                                                |  |
|  |     [committed]<--[merge]                                              |  |
|  |                                                                        |  |
|  |   Each node: hash(state || timestamp || parent_hash || payload_hash)   |  |
|  |                                                                        |  |
|  +------------------------------------------------------------------------+  |
|      |                                                                       |
|      | transition(current_state, event) -> (new_state, merkle_proof)         |
|      v                                                                       |
|  LAYER 1: FATE GATE (Constitutional AI Validation)                           |
|  +------------------------------------------------------------------------+  |
|  |                                                                        |  |
|  |   +----------+     +----------+     +----------+     +----------+     |  |
|  |   | FIDELITY |     |ACCOUNT-  |     |TRANSPARE-|     |  ETHICS  |     |  |
|  |   |          |     |ABILITY   |     |NCY       |     |          |     |  |
|  |   | No secret|     | All ops  |     | No obfus-|     | Block    |     |  |
|  |   | in input |     | logged   |     | cation   |     | danger   |     |  |
|  |   +----------+     +----------+     +----------+     +----------+     |  |
|  |        |               |               |               |              |  |
|  |        +-------+-------+-------+-------+               |              |  |
|  |                |                                       |              |  |
|  |                v                                       v              |  |
|  |        +--------------+                        +--------------+       |  |
|  |        | score >= 0.95|                        | score < 0.95 |       |  |
|  |        | -> ALLOW     |                        | -> BLOCK     |       |  |
|  |        +--------------+                        +--------------+       |  |
|  |                                                                        |  |
|  +------------------------------------------------------------------------+  |
|      |                                                                       |
|      | validate(tool_name, tool_input) -> GateResult(passed, score, reason)  |
|      v                                                                       |
|  LAYER 0: NTU (NeuroTemporal Unit)                                           |
|  +------------------------------------------------------------------------+  |
|  |                                                                        |  |
|  |   Observation Stream                    State Space                    |  |
|  |   +-----------------+                   +-------------------------+    |  |
|  |   | t0: 0.82        |                   |        BELIEF           |    |  |
|  |   | t1: 0.85        |---+               |   0.0 |----X----| 1.0   |    |  |
|  |   | t2: 0.91        |   |               |       (0.93)            |    |  |
|  |   | t3: 0.94        |   |               +-------------------------+    |  |
|  |   | t4: 0.97 <--+   |   |               |        ENTROPY          |    |  |
|  |   +-----------+ |   |   +-------------->|   0.0 |--X------| 1.0   |    |  |
|  |               | |   |                   |       (0.21)            |    |  |
|  |    window=5 --+-+   |                   +-------------------------+    |  |
|  |                     |                   |       POTENTIAL         |    |  |
|  |                     +------------------>|   0.0 |------X--| 1.0   |    |  |
|  |                                         |       (0.73)            |    |  |
|  |                                         +-------------------------+    |  |
|  |                                                                        |  |
|  |   UPDATE: belief_new = 0.4*temporal + 0.35*neural + 0.25*belief_old    |  |
|  |                                                                        |  |
|  +------------------------------------------------------------------------+  |
|                                                                              |
+=============================================================================+
```

---

## 3. NTU State Machine

```
+===========================================================================+
|                           NTU STATE MACHINE                                |
+===========================================================================+
|                                                                            |
|  INPUTS                                    PROCESSING                      |
|  +------------------+                      +---------------------------+   |
|  | observation: f64 |                      |                           |   |
|  | value in [0,1]   |                      |    TEMPORAL CONSISTENCY   |   |
|  +--------+---------+                      |    +-------------------+  |   |
|           |                                |    | variance analysis |  |   |
|           v                                |    | monotonicity      |  |   |
|  +------------------+                      |    | window: 5 obs     |  |   |
|  |  CLASSIFY TYPE   |                      |    +-------------------+  |   |
|  | < 0.33 -> LOW    |                      |             |            |   |
|  | < 0.67 -> MEDIUM |                      |             v            |   |
|  | else   -> HIGH   |                      |    NEURAL PRIOR LOOKUP   |   |
|  +--------+---------+                      |    +-------------------+  |   |
|           |                                |    | LOW:  [.1,.2,.7]  |  |   |
|           v                                |    | MED:  [.4,.4,.2]  |  |   |
|  +------------------+                      |    | HIGH: [.8,.1,.1]  |  |   |
|  |  ADD TO MEMORY   |                      |    +-------------------+  |   |
|  | deque.append(obs)|--------------------->|             |            |   |
|  | if len > window: |                      |             v            |   |
|  |   deque.popleft()|                      |    BAYESIAN UPDATE       |   |
|  +------------------+                      |    +-------------------+  |   |
|                                            |    | a=.4, b=.35, g=.25|  |   |
|                                            |    | belief_new =      |  |   |
|                                            |    |   a*temp +        |  |   |
|                                            |    |   b*neural[0] +   |  |   |
|                                            |    |   g*belief_old    |  |   |
|                                            |    +-------------------+  |   |
|                                            |             |            |   |
|                                            +-------------+------------+   |
|                                                          |                |
|  STATE OUTPUT                                            v                |
|  +----------------------------------------------------------+            |
|  |                                                          |            |
|  |  NTUState {                                              |            |
|  |    belief:    0.93,   // certainty score                 |            |
|  |    entropy:   0.21,   // Shannon entropy of memory       |            |
|  |    potential: 0.73,   // belief * (1 - entropy)          |            |
|  |    iteration: 1042    // observation count               |            |
|  |  }                                                       |            |
|  |                                                          |            |
|  +----------------------------------------------------------+            |
|                                                                           |
|  PATTERN DETECTION:                                                       |
|  +----------------------------------------------------------+            |
|  |  if state.belief >= ihsan_threshold (0.95):              |            |
|  |    return (detected=true, confidence=belief)             |            |
|  |  else:                                                   |            |
|  |    return (detected=false, confidence=belief)            |            |
|  +----------------------------------------------------------+            |
|                                                                           |
+===========================================================================+
```

---

## 4. Federation Topology

```
+===========================================================================+
|                         FEDERATION TOPOLOGY                                |
+===========================================================================+
|                                                                            |
|                         SUPER-PEER LAYER                                   |
|                    (BFT Consensus Coordinators)                            |
|                                                                            |
|    +-------+       +-------+       +-------+       +-------+               |
|    |  SP1  |<----->|  SP2  |<----->|  SP3  |<----->|  SP4  |               |
|    +---+---+       +---+---+       +---+---+       +---+---+               |
|        |               |               |               |                   |
|        |   CROSS-REGION CONSENSUS (2f+1 BFT)           |                   |
|        |               |               |               |                   |
|  +-----+-----+   +-----+-----+   +-----+-----+   +-----+-----+             |
|  |           |   |           |   |           |   |           |             |
|  v           v   v           v   v           v   v           v             |
|                                                                            |
|  REGIONAL CLUSTER: APAC                                                    |
|  +-------------------------------------------------------------------+    |
|  |                                                                   |    |
|  |   +-----+     +-----+     +-----+     +-----+     +-----+        |    |
|  |   | N1  |<--->| N2  |<--->| N3  |<--->| N4  |<--->| N5  |        |    |
|  |   +--+--+     +--+--+     +--+--+     +--+--+     +--+--+        |    |
|  |      |           |           |           |           |           |    |
|  |      +-----+-----+-----+-----+-----+-----+-----+-----+           |    |
|  |            |                 |                 |                 |    |
|  |            v                 v                 v                 |    |
|  |   +--------+--------+--------+--------+--------+--------+        |    |
|  |   | GOSSIP PROTOCOL: Fanout=3, Interval=5s              |        |    |
|  |   +-----------------------------------------------------+        |    |
|  |                                                                   |    |
|  +-------------------------------------------------------------------+    |
|                                                                            |
|  GOSSIP MESSAGE TYPES:                                                     |
|  +-------------------------------------------------------------------+    |
|  | PING    -> heartbeat (node_id, state, belief)                     |    |
|  | PONG    -> heartbeat response                                     |    |
|  | SYNC    -> state reconciliation request                           |    |
|  | PATTERN -> elevated pattern broadcast (snr >= 0.95)               |    |
|  +-------------------------------------------------------------------+    |
|                                                                            |
|  FAILURE DETECTION (Phi Accrual):                                          |
|  +-------------------------------------------------------------------+    |
|  | ACTIVE  -> heartbeat received within timeout                      |    |
|  | SUSPECT -> heartbeat missing (phi > 8)                            |    |
|  | DEAD    -> confirmed unreachable (phi > 16, 3 peers agree)        |    |
|  +-------------------------------------------------------------------+    |
|                                                                            |
+===========================================================================+
```

---

## 5. PCI Envelope Structure

```
+===========================================================================+
|                          PCI ENVELOPE STRUCTURE                            |
+===========================================================================+
|                                                                            |
|  +---------------------------------------------------------------------+  |
|  |                         PCIEnvelope                                 |  |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  HEADER                                                             |  |
|  |  +---------------------------------------------------------------+  |  |
|  |  | version:      "1.0"                                           |  |  |
|  |  | agent_type:   "USER" | "MODEL" | "SOVEREIGN"                  |  |  |
|  |  | node_id:      "bizra-node0-abc123"                            |  |  |
|  |  | timestamp:    "2026-02-03T10:30:00Z"                          |  |  |
|  |  | ttl_seconds:  3600                                            |  |  |
|  |  +---------------------------------------------------------------+  |  |
|  |                                                                     |  |
|  |  QUALITY SCORES                                                     |  |
|  |  +---------------------------------------------------------------+  |  |
|  |  | ihsan_score:  0.96   (>= 0.95 required)                       |  |  |
|  |  | snr_score:    0.89   (>= 0.85 required)                       |  |  |
|  |  +---------------------------------------------------------------+  |  |
|  |                                                                     |  |
|  |  PAYLOAD                                                            |  |
|  |  +---------------------------------------------------------------+  |  |
|  |  | {                                                             |  |  |
|  |  |   "request_type": "inference",                                |  |  |
|  |  |   "prompt": "Explain quantum computing",                      |  |  |
|  |  |   "parameters": {                                             |  |  |
|  |  |     "max_tokens": 1024,                                       |  |  |
|  |  |     "temperature": 0.7                                        |  |  |
|  |  |   }                                                           |  |  |
|  |  | }                                                             |  |  |
|  |  +---------------------------------------------------------------+  |  |
|  |                                                                     |  |
|  |  SIGNATURE                                                          |  |
|  |  +---------------------------------------------------------------+  |  |
|  |  | algorithm:    "Ed25519"                                       |  |  |
|  |  | signature:    "base64(sign(domain_prefix || canonical_json))" |  |  |
|  |  | public_key:   "base64(ed25519_public_key)"                    |  |  |
|  |  +---------------------------------------------------------------+  |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  VERIFICATION CHAIN:                                                       |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  1. CHECK TTL                                                       |  |
|  |     +-----------------------------------------------------------+  |  |
|  |     | if (now - timestamp) > ttl_seconds:                       |  |  |
|  |     |   return Reject(R001_TTL_EXPIRED)                         |  |  |
|  |     +-----------------------------------------------------------+  |  |
|  |                                 |                                   |  |
|  |                                 v                                   |  |
|  |  2. VERIFY SIGNATURE                                                |  |
|  |     +-----------------------------------------------------------+  |  |
|  |     | digest = blake3(DOMAIN_PREFIX + canonical_json(payload))  |  |  |
|  |     | if !ed25519_verify(signature, digest, public_key):        |  |  |
|  |     |   return Reject(R002_INVALID_SIGNATURE)                   |  |  |
|  |     +-----------------------------------------------------------+  |  |
|  |                                 |                                   |  |
|  |                                 v                                   |  |
|  |  3. CHECK IHSAN                                                     |  |
|  |     +-----------------------------------------------------------+  |  |
|  |     | if ihsan_score < 0.95:                                    |  |  |
|  |     |   return Reject(R003_IHSAN_BELOW_THRESHOLD)               |  |  |
|  |     +-----------------------------------------------------------+  |  |
|  |                                 |                                   |  |
|  |                                 v                                   |  |
|  |  4. CHECK SNR                                                       |  |
|  |     +-----------------------------------------------------------+  |  |
|  |     | if snr_score < 0.85:                                      |  |  |
|  |     |   return Reject(R004_SNR_BELOW_THRESHOLD)                 |  |  |
|  |     +-----------------------------------------------------------+  |  |
|  |                                 |                                   |  |
|  |                                 v                                   |  |
|  |  5. ACCEPT                                                          |  |
|  |     +-----------------------------------------------------------+  |  |
|  |     | return Accept(payload)                                    |  |  |
|  |     +-----------------------------------------------------------+  |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
+===========================================================================+
```

---

## 6. Inference Tier Selection

```
+===========================================================================+
|                       INFERENCE TIER SELECTION                             |
+===========================================================================+
|                                                                            |
|  INPUT: Task Request                                                       |
|  +---------------------------------------------------------------------+  |
|  | prompt:       "Explain quantum computing"                           |  |
|  | token_count:  estimated 500                                         |  |
|  | latency_req:  < 2s                                                  |  |
|  | domain:       "science"                                             |  |
|  +---------------------------------------------------------------------+  |
|                               |                                            |
|                               v                                            |
|  TASK ANALYZER                                                             |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  Complexity Score = f(token_count, domain, query_depth)             |  |
|  |                                                                     |  |
|  |  +-------------------------+                                        |  |
|  |  | token_count < 100       |---> SIMPLE     (0.2)                   |  |
|  |  | token_count < 500       |---> MODERATE   (0.5)                   |  |
|  |  | token_count < 2000      |---> COMPLEX    (0.7)                   |  |
|  |  | token_count >= 2000     |---> EXPERT     (0.9)                   |  |
|  |  +-------------------------+                                        |  |
|  |                                                                     |  |
|  |  Domain Multiplier:                                                 |  |
|  |  +-------------------------+                                        |  |
|  |  | general        | 1.0   |                                        |  |
|  |  | code           | 1.2   |                                        |  |
|  |  | math           | 1.3   |                                        |  |
|  |  | science        | 1.2   |                                        |  |
|  |  | reasoning      | 1.4   |                                        |  |
|  |  +-------------------------+                                        |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                               |                                            |
|                               v                                            |
|  TIER SELECTION                                                            |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  final_complexity = base_complexity * domain_multiplier             |  |
|  |                   = 0.5 * 1.2 = 0.6                                 |  |
|  |                                                                     |  |
|  |  +-------+--------+--------------+------------+------------------+  |  |
|  |  | Tier  | Range  | Model Size   | Latency    | Selection        |  |  |
|  |  +-------+--------+--------------+------------+------------------+  |  |
|  |  | NANO  | [0,0.3)| 0.5B-1.5B    | < 100ms    |                  |  |  |
|  |  | MICRO | [0.3,0.5)| 1.5B-3B    | < 500ms    |                  |  |  |
|  |  | MESO  | [0.5,0.7)| 7B-13B     | < 2s       | <-- SELECTED     |  |  |
|  |  | MACRO | [0.7,0.9)| 13B-34B    | < 10s      |                  |  |  |
|  |  | MEGA  | [0.9,1.0]| 70B+       | < 60s      |                  |  |  |
|  |  +-------+--------+--------------+------------+------------------+  |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                               |                                            |
|                               v                                            |
|  BACKEND ROUTING                                                           |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  Selected: MESO (7B model)                                          |  |
|  |                                                                     |  |
|  |  Backend Priority:                                                  |  |
|  |  1. LM Studio (192.168.56.1:1234) -- if available                   |  |
|  |  2. Ollama (localhost:11434)      -- fallback                       |  |
|  |                                                                     |  |
|  |  Model Selection (MESO tier):                                       |  |
|  |  - qwen2.5-7b-instruct                                              |  |
|  |  - mistral-7b-instruct                                              |  |
|  |  - llama3-8b-instruct                                               |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
+===========================================================================+
```

---

## 7. Claude Code Hooks Integration

```
+===========================================================================+
|                     CLAUDE CODE HOOKS INTEGRATION                          |
+===========================================================================+
|                                                                            |
|  HOOK CONFIGURATION (.claude/settings.json)                                |
|  +---------------------------------------------------------------------+  |
|  | {                                                                   |  |
|  |   "hooks": {                                                        |  |
|  |     "PreToolUse": [{                                                |  |
|  |       "file": ".claude/hooks/fate_gate.py",                         |  |
|  |       "matcher": "Bash|Write|Edit|WebFetch"                         |  |
|  |     }],                                                             |  |
|  |     "PostToolUse": [{                                               |  |
|  |       "file": ".claude/hooks/ntu_monitor.py",                       |  |
|  |       "matcher": ".*"                                               |  |
|  |     }],                                                             |  |
|  |     "Stop": [{                                                      |  |
|  |       "file": ".claude/hooks/session_memory.py"                     |  |
|  |     }]                                                              |  |
|  |   }                                                                 |  |
|  | }                                                                   |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  EXECUTION FLOW                                                            |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |   User Request                                                      |  |
|  |        |                                                            |  |
|  |        v                                                            |  |
|  |   +----+----+     +-----------------+                               |  |
|  |   | Claude  |---->| Tool Invocation |                               |  |
|  |   | Code    |     | (e.g., Bash)    |                               |  |
|  |   +---------+     +--------+--------+                               |  |
|  |                            |                                        |  |
|  |                   +--------v--------+                               |  |
|  |                   | PreToolUse Hook |                               |  |
|  |                   | (FATE Gate)     |                               |  |
|  |                   +--------+--------+                               |  |
|  |                            |                                        |  |
|  |              +-------------+-------------+                          |  |
|  |              |                           |                          |  |
|  |              v                           v                          |  |
|  |   +---------+--------+       +----------+---------+                 |  |
|  |   | ALLOW             |       | BLOCK              |                 |  |
|  |   | (score >= 0.95)   |       | (score < 0.95)     |                 |  |
|  |   +--------+----------+       +--------------------+                 |  |
|  |            |                            |                           |  |
|  |            v                            v                           |  |
|  |   +--------+--------+          +--------+--------+                  |  |
|  |   | Execute Tool    |          | Return Error    |                  |  |
|  |   +--------+--------+          +-----------------+                  |  |
|  |            |                                                        |  |
|  |            v                                                        |  |
|  |   +--------+--------+                                               |  |
|  |   | PostToolUse Hook|                                               |  |
|  |   | (NTU Monitor)   |                                               |  |
|  |   +--------+--------+                                               |  |
|  |            |                                                        |  |
|  |            v                                                        |  |
|  |   +--------+--------+                                               |  |
|  |   | Update NTU State|                                               |  |
|  |   | Log to JSONL    |                                               |  |
|  |   +-----------------+                                               |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  HOOK FILES                                                                |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  .claude/hooks/                                                     |  |
|  |    fate_gate.py       -- FATE validation (PreToolUse)               |  |
|  |    ntu_monitor.py     -- Pattern tracking (PostToolUse)             |  |
|  |    session_memory.py  -- Memory persistence (Stop)                  |  |
|  |                                                                     |  |
|  |  .claude/logs/                                                      |  |
|  |    fate_gate.jsonl    -- Decision audit trail                       |  |
|  |    ntu_observations.jsonl -- Observation stream                     |  |
|  |    ntu_state.json     -- Current NTU state                          |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
+===========================================================================+
```

---

## 8. Rust Module Structure (bizra-omega)

```
+===========================================================================+
|                    BIZRA-OMEGA RUST WORKSPACE                              |
+===========================================================================+
|                                                                            |
|  Cargo.toml (workspace)                                                    |
|  +---------------------------------------------------------------------+  |
|  | [workspace]                                                         |  |
|  | members = [                                                         |  |
|  |   "bizra-core",       # Identity, PCI, Constitution, SIMD           |  |
|  |   "bizra-federation", # Gossip, Consensus, Bootstrap                |  |
|  |   "bizra-inference",  # LLM Gateway, Model Selection                |  |
|  |   "bizra-autopoiesis",# Self-modification, Evolution                |  |
|  |   "bizra-python",     # PyO3 Bindings                               |  |
|  |   "bizra-api",        # HTTP/gRPC API                               |  |
|  |   "bizra-tests",      # Integration Tests                           |  |
|  |   "bizra-ntu",        # (Planned) NTU Rust Implementation           |  |
|  | ]                                                                   |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  MODULE DEPENDENCIES                                                       |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |                    +-------------+                                  |  |
|  |                    | bizra-api   |                                  |  |
|  |                    +------+------+                                  |  |
|  |                           |                                         |  |
|  |              +------------+------------+                            |  |
|  |              |                         |                            |  |
|  |              v                         v                            |  |
|  |    +---------+--------+     +---------+---------+                   |  |
|  |    | bizra-inference  |     | bizra-federation  |                   |  |
|  |    +--------+---------+     +---------+---------+                   |  |
|  |             |                         |                             |  |
|  |             +-----------+-------------+                             |  |
|  |                         |                                           |  |
|  |                         v                                           |  |
|  |               +---------+---------+                                 |  |
|  |               |    bizra-core     |                                 |  |
|  |               | (identity, pci,   |                                 |  |
|  |               |  constitution)    |                                 |  |
|  |               +-------------------+                                 |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  bizra-core/src/                                                           |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  lib.rs                                                             |  |
|  |    |-- pub mod identity;     // NodeIdentity, NodeId                |  |
|  |    |-- pub mod constitution; // Constitution, IhsanThreshold        |  |
|  |    |-- pub mod pci/          // PCIEnvelope, GateChain              |  |
|  |    |     |-- mod.rs                                                 |  |
|  |    |     |-- envelope.rs                                            |  |
|  |    |     |-- gates.rs                                               |  |
|  |    |     |-- crypto.rs                                              |  |
|  |    |-- pub mod simd/         // SIMD-accelerated operations         |  |
|  |    |     |-- mod.rs                                                 |  |
|  |    |     |-- batch_verify.rs // 4x signature verification           |  |
|  |    |     |-- batch_gates.rs  // 2x gate validation                  |  |
|  |    |-- pub mod sovereign/    // SNR, ThoughtGraph, Omega            |  |
|  |         |-- mod.rs                                                  |  |
|  |         |-- snr.rs                                                  |  |
|  |         |-- thought_graph.rs                                        |  |
|  |         |-- orchestrator.rs                                         |  |
|  |         |-- omega.rs                                                |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  bizra-federation/src/                                                     |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  lib.rs                                                             |  |
|  |    |-- pub mod gossip;       // GossipEngine, GossipMessage         |  |
|  |    |-- pub mod consensus;    // BFT, Vote, Proposal                 |  |
|  |    |-- pub mod bootstrap;    // Initial peer discovery              |  |
|  |    |-- pub mod node;         // FederationNode                      |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  bizra-ntu/src/ (Planned)                                                  |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  lib.rs                                                             |  |
|  |    |-- pub mod ntu;          // NTU, NTUState, NTUConfig            |  |
|  |    |-- pub mod observation;  // Observation, ObservationType        |  |
|  |    |-- pub mod pattern;      // PatternDetector                     |  |
|  |    |-- pub mod markov;       // TransitionMatrix, Stationary        |  |
|  |    |-- pub mod bridge;       // SNR adapter                         |  |
|  |    |-- pub mod pyo3;         // Python bindings                     |  |
|  |                                                                     |  |
|  |  Performance Targets:                                               |  |
|  |    - 100ns per observation                                          |  |
|  |    - < 1KB per instance                                             |  |
|  |    - WASM < 100KB                                                   |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
+===========================================================================+
```

---

## 9. Data Storage Architecture

```
+===========================================================================+
|                       DATA STORAGE ARCHITECTURE                            |
+===========================================================================+
|                                                                            |
|  BIZRA-DATA-LAKE/                                                          |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  00_INTAKE/          <-- Drop zone (auto-processed)                 |  |
|  |      |                                                              |  |
|  |      | DataLakeProcessor.ps1                                        |  |
|  |      v                                                              |  |
|  |  01_RAW/             <-- Immutable timestamped backups              |  |
|  |      |                                                              |  |
|  |      v                                                              |  |
|  |  02_PROCESSED/       <-- Organized by type                          |  |
|  |      |-- images/                                                    |  |
|  |      |-- documents/                                                 |  |
|  |      |-- code/                                                      |  |
|  |      |-- text/                                                      |  |
|  |      |-- data/                                                      |  |
|  |      |                                                              |  |
|  |      | corpus_manager.py (Layer 1)                                  |  |
|  |      v                                                              |  |
|  |  04_GOLD/            <-- Curated datasets                           |  |
|  |      |-- documents.parquet   (source docs)                          |  |
|  |      |-- chunks.parquet      (embeddings)                           |  |
|  |      |-- assertions.jsonl    (LLM extractions)                      |  |
|  |                                                                     |  |
|  |  03_INDEXED/         <-- Vector embeddings + graph                  |  |
|  |      |-- faiss.index         (FAISS similarity search)              |  |
|  |      |-- graph.pkl           (knowledge graph)                      |  |
|  |                                                                     |  |
|  |  99_QUARANTINE/      <-- Duplicates, corrupted                      |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  .claude-flow/memory/   <-- Session and knowledge persistence              |  |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  governance-stack-knowledge.json   <-- 5-Layer Stack docs           |  |
|  |  ntu-knowledge.json               <-- NTU specification              |  |
|  |  hooks-integration.json            <-- Hook configuration            |  |
|  |  session_history.jsonl             <-- Session summaries             |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  .claude/logs/          <-- Hook execution logs                            |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  fate_gate.jsonl      <-- FATE decisions (audit trail)              |  |
|  |  ntu_observations.jsonl <-- NTU observation stream                  |  |
|  |  ntu_state.json       <-- Current NTU state snapshot                |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
|  sovereign_state/       <-- Runtime persistence                            |
|  +---------------------------------------------------------------------+  |
|  |                                                                     |  |
|  |  sessions/            <-- Active session DAGs                       |  |
|  |  licenses/            <-- Compute market licenses                   |  |
|  |  patterns/            <-- Elevated patterns                         |  |
|  |                                                                     |  |
|  +---------------------------------------------------------------------+  |
|                                                                            |
+===========================================================================+
```

---

**END OF DIAGRAMS**

*Companion to: ARCHITECTURE_BLUEPRINT_v2.3.0.md*
